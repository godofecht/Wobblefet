((t,n)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).XYPad=n()})(this,function(){Object.defineProperty(o.prototype,"point",{get:function(){return{x:this.x,y:this.y}},enumerable:!1,configurable:!0}),o.prototype.moveTo=function(t,n){var i,e;this.isPointer(t)?(i=(e=t.point).x,e=e.y,this.x=i,this.y=e):(this.x=t,this.y=n)},o.prototype.equals=function(t,n){var i,e;return this.isPointer(t)?(e=(i=t.point).x,this.x===e&&this.y===i.y):this.x===t&&this.y===n},o.prototype.add=function(t,n){var i,e;return this.isPointer(t)?(e=(i=t.point).x,new o(this.x+e,this.y+i.y)):new o(this.x+t,this.y+n)},o.prototype.sub=function(t,n){var i,e;return this.isPointer(t)?(e=(i=t.point).x,new o(this.x-e,this.y-i.y)):new o(this.x-t,this.y-n)},o.prototype.toString=function(){return"{ x: "+this.point.x.toFixed(2)+", y: "+this.point.y.toFixed(2)+" }"},o.prototype.isPointer=function(t){return t instanceof o};var d=o;function o(t,n){void 0===n&&(n=0),this.x=t=void 0===t?0:t,this.y=n}Object.defineProperty(t.prototype,"point",{get:function(){return this.currentPoint},set:function(t){this.currentPoint=t},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){this.element.addEventListener("mousedown",this.dragStart.bind(this)),document.addEventListener("mousemove",this.dragMove.bind(this)),document.addEventListener("mouseup",this.dragEnd.bind(this))},t.prototype.destroy=function(){this.element.removeEventListener("mousedown",this.dragStart.bind(this)),document.removeEventListener("mousemove",this.dragMove.bind(this)),document.removeEventListener("mouseup",this.dragEnd.bind(this))},t.prototype.dragStart=function(t){this.isDragging=!0,this.currentPoint.moveTo(t.offsetX,t.offsetY),this.canvasPoint.moveTo(t.offsetX,t.offsetY),this.startPoint.moveTo(t.pageX,t.pageY),this.onDragStart(this.currentPoint)},t.prototype.dragMove=function(t){this.isDragging&&(t=new d(t.pageX,t.pageY),this.currentPoint=this.forceInElement(t.sub(this.startPoint).add(this.canvasPoint),this.element),this.onDragMove(this.currentPoint))},t.prototype.dragEnd=function(t){this.isDragging&&(this.isDragging=!1,t=new d(t.pageX,t.pageY),this.currentPoint=this.forceInElement(t.sub(this.startPoint).add(this.canvasPoint),this.element),this.onDragEnd(this.currentPoint))},t.prototype.forceInElement=function(t,n){var i=n.width,n=n.height,t=t.point,e=t.x,t=t.y,o=e,r=t;return new d(o=i<(o=e<0?0:e)?i:o,r=n<(r=t<0?0:t)?n:r)};var p=t;function t(t){var n=t.element,i=t.pointer,i=void 0===i?new d:i,e=t.onDragStart,e=void 0===e?function(){}:e,o=t.onDragMove,o=void 0===o?function(){}:o,t=t.onDragEnd,t=void 0===t?function(){}:t;this.canvasPoint=new d,this.startPoint=new d,this.isDragging=!1,this.element=n,this.onDragStart=e,this.onDragMove=o,this.onDragEnd=t,this.currentPoint=i,this.initialize()}Object.defineProperty(n.prototype,"range",{get:function(){return{min:this.min,max:this.max}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this.max-this.min},enumerable:!1,configurable:!0}),n.prototype.isInRange=function(t){return this.min<=t&&t<=this.max};var i=n;function n(t){var n=t.min,t=t.max;this.min=n,this.max=t}Object.defineProperty(e.prototype,"xRange",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yRange",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"xDistance",{get:function(){return this.x.distance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yDistance",{get:function(){return this.y.distance},enumerable:!1,configurable:!0});var g=e;function e(t){var n=t.x,t=t.y;this.x=new i({min:n.min,max:n.max}),this.y=new i({min:t.min,max:t.max})}function r(t){var n=this,i=t.el,e=t.pointerColor,e=void 0===e?"black":e,o=t.width,o=void 0===o?300:o,r=t.height,r=void 0===r?300:r,s=t.xRange,s=void 0===s?{min:-100,max:100}:s,a=t.yRange,a=void 0===a?{min:-100,max:100}:a,h=t.onDragStart,h=void 0===h?function(){}:h,c=t.onDragMove,c=void 0===c?function(){}:c,u=t.onDragEnd,u=void 0===u?function(){}:u,t=t.callback,t=void 0===t?function(){}:t,i=(this.pointRadius=4,this.pointZoomRate=2,document.querySelector(i));this.canvas=document.createElement("canvas"),this.canvas.classList.add("xypad"),this.canvas.style.cursor="pointer",this.canvas.width=o,this.canvas.height=r,i.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.pointerColor=e,this.xyRange=new g({x:s,y:a}),this.onDragStart=h,this.onDragMove=c,this.onDragEnd=u,this.callback=t,this.draggablePointer=new p({element:this.canvas,pointer:new d(o/2,r/2),onDragStart:function(t){n.pointRadius*=n.pointZoomRate,n.render(t),n.onDragStart(n.calcPoint(t)),n.callback(n.calcPoint(t))},onDragMove:function(t){n.render(t),n.onDragMove(n.calcPoint(t)),n.callback(n.calcPoint(t))},onDragEnd:function(t){n.pointRadius/=n.pointZoomRate,n.render(t),n.onDragEnd(n.calcPoint(t)),n.callback(n.calcPoint(t))}}),this.render(this.draggablePointer.point)}return r.prototype.render=function(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.context.fillStyle=this.pointerColor,this.context.beginPath();t=t.sub(this.pointRadius/(2*this.pointZoomRate),this.pointRadius/(2*this.pointZoomRate));this.context.arc(t.point.x,t.point.y,this.pointRadius,0,2*Math.PI),this.context.fill(),this.context.restore()},r.prototype.calcPoint=function(t){var n=this.xyRange.xDistance/this.canvas.width*t.point.x-this.xyRange.xDistance/2,t=this.xyRange.yDistance/this.canvas.width*t.point.y-this.xyRange.yDistance/2;return new d(n,t)},r.prototype.movePointerTo=function(t,n){t instanceof d?this.draggablePointer.point=t:this.draggablePointer.point=new d(t,n)},r.prototype.destroy=function(){this.draggablePointer.destroy()},r.prototype.getPointer=function(){return this.draggablePointer.point},r});
